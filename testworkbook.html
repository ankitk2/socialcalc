<!--
playground to test multiple sheets in a page
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>SocialCalc 0.8.1</title>
<script type="text/javascript" src="socialcalcconstants.js"></script>
<script type="text/javascript" src="socialcalc-3.js"></script>
<script type="text/javascript" src="socialcalctableeditor.js"></script>
<script type="text/javascript" src="formatnumber2.js"></script>
<script type="text/javascript" src="formula1.js"></script>
<script type="text/javascript" src="socialcalcpopup.js"></script>
<script type="text/javascript" src="socialcalcspreadsheetcontrol.js"></script>
<script type="text/javascript" src="socialcalcworkbook.js"></script>
<style>
body, td, input, texarea {font-family:verdana,helvetica,sans-serif;font-size:small;}
.smaller {font-size:smaller;}
</style>
</head>


<body style="background-color:#FFF;" onresize="spreadsheet.DoOnResize();">

<div id="fooBar" style="padding:6px;background-color:#80A9F3;">
<input type="button" id="sheet1" name="1" value="sheet1" style="background-color:lightgreen" onclick="clickButtonFooBar('sheet1');">
</div>

<form>
<div style="padding:6px;background-color:#80A9F3;">
<input type="button" value="add sheet" onclick="addButtonFooBar('button')" class="smaller">
<input type="button" value="del sheet" onclick="delButtonFooBar()" class="smaller">
<input type="button" value="save workbook" onclick="saveButtonFooBar()" class="smaller">
</div>
</form>


<div style="margin:8px 0px 10px 0px;">
 <div id="tableeditor" style="margin:8px 0px 10px 0px;">editor goes here</div>
</div>
 <div id="msg" onclick="this.innerHTML='&nbsp;';"></div>


<script>

var sheetButtonArr = {};
var sheetCnt = 1;
var numSheets = 1;
var currentSheetButton = document.getElementById("sheet1");;
sheetButtonArr["sheet1"] = currentSheetButton;

var spreadsheet = new SocialCalc.SpreadsheetControl();
var workbook = new SocialCalc.WorkBook(spreadsheet);
workbook.InitializeWorkBook();
spreadsheet.InitializeSpreadsheetControl("tableeditor");
spreadsheet.ExecuteCommand('redisplay', '');

function delButtonFooBar(){
	if (numSheets == 1) {
		// disallow
		alert("cant delete only sheet!");
		return;
	}
	if (currentSheetButton != null) {
		var foo = document.getElementById("fooBar");
		var current = document.getElementById(currentSheetButton.id);
		
		var name = current.id;
		delete sheetButtonArr[name];
		//alert("deleting"+name);
		foo.removeChild(current);
		currentSheetButton = null;
		// delete the sheets
		workbook.DeleteWorkBookSheet(name);
		numSheets = numSheets-1;
	}
	
	// reset current sheet
	for (var sheet in sheetButtonArr) {
		if (sheet != null) {
			//alert(sheet)
			currentSheetButton = sheetButtonArr[sheet];
			currentSheetButton.setAttribute("style","background-color:lightgreen");
			break;
		}
	}
	if (currentSheetButton != null) {
		//	alert("current = "+currentSheetButton.id)
		workbook.ActivateWorkBookSheet(currentSheetButton.id, null);
	}
}

function clickButtonFooBar(name) {
	//alert("clicked "+name);
	var foo = document.getElementById(name);
	foo.setAttribute("style","background-color:lightgreen");

    var old = currentSheetButton.id;
	if (currentSheetButton.id != foo.id) {
		currentSheetButton.setAttribute("style", "");
	}
	
	currentSheetButton = foo;

	workbook.ActivateWorkBookSheet(name, old);
}

function addButtonFooBar(type) {
	//Create an input type dynamically.
	var element = document.createElement("input");

	//alert(sheetCnt);
	var name = "sheet"+ (sheetCnt+1).toString();

	//Assign different attributes to the element.
	element.setAttribute("type", type);
	element.setAttribute("value", name);
	element.setAttribute("id", name);
    element.setAttribute("name", (sheetCnt+1));
	
	var fnname = "clickButtonFooBar("+"'"+name+"'"+")";
	element.setAttribute("onclick",fnname);
	
	sheetButtonArr[name] = element;
	sheetCnt = sheetCnt + 1;
	
	var old="sheet1";
	if (currentSheetButton != null) {
		currentSheetButton.setAttribute("style", "");
		old = currentSheetButton.id;
	}
	
	element.setAttribute("style","background-color:lightgreen");
	currentSheetButton = element;
	
	var foo = document.getElementById("fooBar");

	//Append the element in page (in span).
	foo.appendChild(element);

	// create the sheet
	//alert("add new sheet")

	workbook.AddNewWorkBookSheet(name, old);	
	
	numSheets = numSheets + 1;
	
}

function saveButtonFooBar(){
	workbook.CreateSaveWorkBook();
}


</script>
</body>
</html>